# Openwrtデバイスでの結果

### 結論

bcm4708：ARM Cortex-A9 Broadcom BCM4708A0 800MHz 2C2T  
mt7612：MIPS MediaTek MT7621AT 880MHz 2C4T

傾向としては単純にCPUの強さ（シングルスレッドの強さ）とコードの成熟度(おそらくARMのほうが成熟度が高い)に比例していると思われる。  
mt7612は2013年くらいから家庭用市販ルータによく使用されており、各社から出ていた。  
2023年現在ではAArch64(ARM 64Bit)のSoCを使う事例が多いため、新しくこれを採用しようというのはあまり無い。  
bcm4708は2011年からの少し高めの市販ルータでの採用例が何例かあるだけで、あまり見かけない。
    
結果的にはbcm4708のほうが暗号化性能が高い＝シングルスレッド性能が高いと思われる。  
（が、bcm4708は2C2T、mt7621は2C4Tなので並列にジョブが発生した場合はどうなるか…によるとも言えるかもしれない）  
  
通常こういった組み込み向け用途のCPU(SoC)は、AESやSHA用のアクセラレータが入っていることがあるが、これらにも入っているかどうかは不明。  
仮に入っていたとしても、わざわざOpenWrtのopensslライブラリから叩くコードを実装しているとも思えず、この結果はやはりCPUの性能そのものである。  

また、bcm4708はARMV7(Cortex-A9)であるのでAArch64にあるようなAESやSHAの拡張命令も無くそこまで速度は伸びていない。  
Intel i7-950と比べても遅いので、2023年に出ているN100やN95のいわゆるAlder Lake-Nの廉価版を使ってOpenWrtルータを自作した場合はかなりのパフォーマンスが得られるものと思われる。  
(しかもN100はAES-NI拡張命令も使えるのでi7-950よりも良いパフォーマンスが得られる)

両方ともAESで暗号化するよりもChacha-polyで暗号化したほうが良い結果が得られているので、OpenWrtでVPNを建てる場合はOpenVPNよりもWireguardを使ったほうが良好なパフォーマンスが出る。  
（最低でも倍くらいは変化すると思われる）  
  

---
### 測定結果

・ブロック暗号系(16384 bytes)
|  ターゲット  |  AES-128-CBC | AES-256-CBC | AES-128-GCM | AES-256-GCM | ChaPoly |
|  ----  |  ----:  | ----: | ----: | ----: | ----: | 
|  bcm4708  | 23571.11k | 18137.09k | 11539.80k | 10169.00k | 48239.96k |
|  mt7621   | 12225.40k | 9275.19k | 6096.37k | 5258.12k | 20722.22k | 

・ハッシュ系(16384 bytes)
|  ターゲット  | SHA1 | SHA256 | SHA512 | BLAKE2s256 | BLAKE2b512 |
|  ----  |  ----:  | ----: | ----: | ----: | ----: | 
|  bcm4708  | 58654.72k | 35820.89k | 16569.69k | unknown | unknown |
|  mt7621   | 51508.90k | 22480.37k | 7217.67k | unknown | unknown | 

・楕円暗号と認証
|  ターゲット  | op/s(X25519) | op/s(X448) | sign/s(Ed25519) | verify/s(Ed25519) | sign/s(Ed448) | verify/s(Ed448) |
|  ----  |  ----:  | ----: | ----: | ----: | ----: | ----: | 
|  bcm4708  | 644.4 | 96.7 | 1532.7 | 564.9 | 231.9 | 87.6 | 
|  mt7621  | 602.1 | 62.9 | 1207.5 | 559.9 | 136.1 | 56.7 | 
